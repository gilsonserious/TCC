{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nimport { finalize } from \"rxjs/operators\";\nlet ProdutosComponent = class ProdutosComponent {\n  constructor(afs, afAuth, storage) {\n    this.afs = afs;\n    this.afAuth = afAuth;\n    this.storage = storage;\n    this.produtos = [];\n    this.novo = false;\n    this.produto = {\n      titulo: null,\n      preco: null,\n      adicionais: [],\n      variacoes: [],\n      imagem: null,\n      categoria: null,\n      descricao: null\n    };\n    this.title = \"cloudsSorage\";\n    this.selectedFile = null;\n    this.opcional = null;\n    this.adicional = {\n      titulo: null,\n      preco: null\n    };\n    this.categorias = [];\n  } //Upload de imagem\n\n\n  onFileSelected(event) {\n    var n = Date.now();\n    const file = event.target.files[0];\n    const filePath = `imagems/${n}`;\n    const fileRef = this.storage.ref(filePath);\n    const task = this.storage.upload(`imagems/${n}`, file);\n    task.snapshotChanges().pipe(finalize(() => {\n      this.downloadURL = fileRef.getDownloadURL();\n      this.downloadURL.subscribe(url => {\n        //Salva a URL gerada para o arquivo\n        if (url) {\n          this.fb = url;\n          this.produto.imagem = this.fb;\n        }\n      });\n    })).subscribe(url => {\n      if (url) {\n        console.log(url);\n      }\n    });\n  }\n\n  carregar() {\n    //Listar categorias\n    this.afs.firestore.collection('categorias').get().then(r => {\n      let categorias = [];\n      r.forEach(rr => {\n        let obj = rr.data();\n        obj['id'] = rr.id;\n        categorias.push(obj);\n      });\n      this.categorias = categorias; // console.log(this.categorias);\n    }); //Listar produtos\n\n    this.afs.firestore.collection('produtos').get().then(r => {\n      let produtos = [];\n      r.forEach(rr => {\n        let obj = rr.data();\n        obj['id'] = rr.id;\n        produtos.push(obj);\n      });\n      this.produtos = produtos;\n      console.log(this.produtos);\n    });\n  }\n\n  ngOnInit() {\n    // this.afAuth.signInAnonymously();\n    this.carregar();\n  } //Adicionar opcional\n\n\n  addOpcional() {\n    if (this.opcional != '') {\n      this.produto.variacoes.push({\n        titulo: this.opcional,\n        checked: false\n      });\n      this.opcional = '';\n    }\n  }\n\n  excluir(id) {\n    this.afs.firestore.collection('produtos').doc(id).delete().then(() => {\n      this.carregar();\n    });\n  }\n\n  removerOpcional(i) {\n    this.produto.variacoes.splice(i, 1);\n  } //Adicionar adicional\n\n\n  addAdicional() {\n    if (this.adicional.titulo != '' && this.adicional.preco > 0) {\n      this.produto.adicionais.push({\n        titulo: this.adicional.titulo,\n        preco: this.adicional.preco,\n        checked: false\n      });\n      this.adicional.preco = '';\n      this.adicional.titulo = '';\n    }\n  }\n\n  removerAdicional(i) {\n    this.produto.adicionais.splice(i, 1);\n  }\n\n  salvar() {\n    if (this.produto.titulo && this.produto.imagem && this.produto.descricao && this.produto.preco && this.produto.categoria) {\n      this.afs.firestore.collection('produtos').add(this.produto).then(() => {\n        this.carregar();\n        this.novo = false;\n        this.produto = {\n          titulo: null,\n          preco: null,\n          adicionais: [],\n          variacoes: [],\n          imagem: null,\n          categoria: null,\n          descricao: null\n        };\n      });\n    } else {\n      alert('Por favor, preencha todos os campos');\n    }\n  }\n\n};\nProdutosComponent = __decorate([Component({\n  selector: \"app-produtos\",\n  templateUrl: \"./produtos.component.html\"\n})], ProdutosComponent);\nexport { ProdutosComponent };","map":null,"metadata":{},"sourceType":"module"}